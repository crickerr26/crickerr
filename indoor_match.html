// --- GAME MODE SELECTION LOGIC ---
        function selectGameMode(mode) {
            // Hide the selection screen
            document.getElementById('mode-selection-screen').classList.add('hidden');
            document.getElementById('mode-selection-screen').classList.remove('active');
            
            if (mode === 'SINGLE') {
                // Show Single Match Setup (Step 1)
                state.matchType = 'SINGLE';
                const step1 = document.getElementById('setup-step-1');
                step1.classList.remove('hidden');
                setTimeout(() => step1.classList.add('active'), 10);
            } else if (mode === 'TOURNAMENT') {
                // Show Tournament Setup
                state.matchType = 'TOURNAMENT';
                const tourneySetup = document.getElementById('tournament-setup');
                tourneySetup.classList.remove('hidden');
                setTimeout(() => tourneySetup.classList.add('active'), 10);

                // --- BUG FIX: RESTORE LAST KNOWN TOURNAMENT PAGE ---
                // Determine if any tournament page is currently visible
                const pages = ['tourney-page-1', 'tourney-page-2', 'tourney-page-3', 'tourney-page-4'];
                const isAnyVisible = pages.some(id => {
                    const el = document.getElementById(id);
                    return el && !el.classList.contains('hidden');
                });
                
                // If all pages are hidden, restore the last known step
                if (!isAnyVisible) {
                    let lastStep = 1;
                    // Deduce last step by checking which stepper dot was active
                    for (let i = 4; i >= 1; i--) {
                        const dot = document.getElementById(`wiz-dot-${i}`);
                        if (dot && dot.classList.contains('step-active-bg')) {
                            lastStep = i;
                            break;
                        }
                    }
                    const lastPage = document.getElementById(`tourney-page-${lastStep}`);
                    if (lastPage) {
                        lastPage.classList.remove('hidden');
                        if (typeof updateStepper === 'function') updateStepper(lastStep);
                    }
                }
                
                // FIX: Only render if empty (Prevents data loss when navigating back)
                const container = document.getElementById('tournament-slots-container');
                if (!container.innerHTML.trim()) {
                    renderTournamentSlots();
                }
            }
        }
